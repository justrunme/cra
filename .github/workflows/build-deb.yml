name: Build .deb package

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: üì• Checkout code
      uses: actions/checkout@v3

    - name: üõ†Ô∏è Install packaging tools
      run: sudo apt update && sudo apt install -y dpkg-dev

    - name: üì¶ Build .deb package
      run: |
        mkdir -p build/DEBIAN
        mkdir -p build/usr/local/bin
        mkdir -p artifacts

        cat <<EOF > build/DEBIAN/control
        Package: repo-tools
        Version: 1.0.${{ github.run_number }}
        Section: utils
        Priority: optional
        Architecture: amd64
        Maintainer: DevOps Bash Toolkit <devops@example.com>
        Description: CLI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏: create-repo –∏ update-all.
        EOF

        cp create-repo.sh build/usr/local/bin/create-repo
        cp update-all.sh build/usr/local/bin/update-all
        chmod +x build/usr/local/bin/*

        dpkg-deb --build build artifacts/repo-tools_1.0.${{ github.run_number }}.deb

    - name: ‚úÖ Commit .deb back to repo (optional)
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        git add artifacts/
        git commit -m "Add .deb artifact from build"
        git push
      continue-on-error: true
