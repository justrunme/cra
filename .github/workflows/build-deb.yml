name: Build .deb package

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3

    - name: ğŸ› ï¸ Install packaging tools
      run: sudo apt update && sudo apt install -y dpkg-dev

    - name: ğŸ“¦ Build .deb package
      run: |
        mkdir -p build/DEBIAN
        mkdir -p build/usr/local/bin

        cat <<EOF > build/DEBIAN/control
        Package: repo-tools
        Version: 1.0.${{ github.run_number }}
        Section: utils
        Priority: optional
        Architecture: amd64
        Maintainer: DevOps Bash Toolkit <devops@example.com>
        Description: CLI-Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸: create-repo Ğ¸ update-all.
        EOF

        cp create-repo.sh build/usr/local/bin/create-repo
        cp update-all.sh build/usr/local/bin/update-all
        chmod +x build/usr/local/bin/*

        dpkg-deb --build build repo-tools_1.0.${{ github.run_number }}.deb

    - name: ğŸš€ Upload .deb artifact
      uses: actions/upload-artifact@v3.1.3
      with:
        name: repo-tools-deb
        path: repo-tools_1.0.*.deb
