#!/bin/bash

CONFIG_FILE="$HOME/.create-repo.conf"
[ -f "$CONFIG_FILE" ] && source "$CONFIG_FILE"

mkdir -p ~/.create-repo/templates

# ๐ง ะะพะดะดะตัะถะบะฐ ัะปะฐะณะพะฒ
show_version=false
show_status=false
show_log=false
log_lines=20
run_update=false
run_clean=false
dry_run=false
interactive=false
show_help=false

while [[ $# -gt 0 ]]; do
  case $1 in
    --status) show_status=true ; shift ;;
    --log) show_log=true; log_lines="${2:-20}"; shift 2;;
    --update) run_update=true ; shift ;;
    --clean) run_clean=true ; shift ;;
    --dry-run) dry_run=true ; shift ;;
    --interactive) interactive=true ; shift ;;
    -h|--help) show_help=true ; shift ;;
    --version) show_version=true ; shift ;;
    *) repo=$1; shift ;;
  esac
done

# ๐ ะะตัะตะผะตะฝะฝัะต
if $show_version; then
  VERSION=$(dpkg -s create-repo-auto 2>/dev/null | grep '^Version:' | awk '{print $2}')
  if [ -n "$VERSION" ]; then
    echo "create-repo version $VERSION"
  else
    echo "create-repo version unknown (not installed via .deb)"
  fi
  exit 0
fi
REPO_LIST="$HOME/.repo-autosync.list"
LOG_FILE="$HOME/.create-repo.log"
SCRIPT_PATH="/usr/local/bin/update-all"

# ๐ --help
repo=${repo:-$(basename "$PWD")}
default_visibility=${default_visibility:-public}
default_cron_interval=${default_cron_interval:-1}

if command -v gh &>/dev/null; then
  platform="github"
elif [ -n "$GITLAB_TOKEN" ]; then
  platform="gitlab"
else
  platform="ะฝะต ะพะฟัะตะดะตะปะตะฝะฐ"
fi

echo "โ ะะฐะนะดะตะฝะพ: git"
echo "โ ะะฐะนะดะตะฝะพ: curl"
echo "โ ะะฐะนะดะตะฝะพ: crontab"
if command -v gh &>/dev/null; then echo "โ ะะฐะนะดะตะฝะพ: gh"; fi
echo "๐ ะขะตะบััะฐั ะดะธัะตะบัะพัะธั: $PWD"
echo "๐ค ะะผั ัะตะฟะพะทะธัะพัะธั: $repo"
echo "๐ ะะปะฐััะพัะผะฐ ะฒัะฑัะฐะฝะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ: $platform"
echo "๐ ะะธะดะธะผะพััั: $default_visibility"
echo "โฑ ะะฝัะตัะฒะฐะป cron: $default_cron_interval ะผะธะฝ"
echo "----------------------------------------"
